{"ast":null,"code":"import _regeneratorRuntime from \"C:\\\\Users\\\\MultiWEB\\\\Desktop\\\\toni-esterco\\\\node_modules\\\\babel-preset-react-app\\\\node_modules\\\\@babel\\\\runtime/regenerator\";\n\nvar _marked =\n/*#__PURE__*/\n_regeneratorRuntime.mark(fetchHeroes),\n    _marked2 =\n/*#__PURE__*/\n_regeneratorRuntime.mark(paginate),\n    _marked3 =\n/*#__PURE__*/\n_regeneratorRuntime.mark(filterByName);\n\nimport { takeLatest, put, call, select } from 'redux-saga/effects';\nimport { Types, Creators } from './heroes-duck';\nimport { Creators as TemplateCreators } from '../template-duck';\nimport md5 from \"js-md5\";\nvar PUBLIC_KEY = '8753d3f72d17692c327806bc8a360493';\nvar timestamp = Number(new Date());\nvar hash = md5.create();\n\nvar getHeroesState = function getHeroesState(state) {\n  return state.Heroes;\n};\n\nfunction fetchHeroes() {\n  var state, _filterByName, offset, response, responseBody, _responseBody$data, total, results;\n\n  return _regeneratorRuntime.wrap(function fetchHeroes$(_context) {\n    while (1) {\n      switch (_context.prev = _context.next) {\n        case 0:\n          _context.prev = 0;\n          _context.next = 3;\n          return put(TemplateCreators.showLoader());\n\n        case 3:\n          _context.next = 5;\n          return select(getHeroesState);\n\n        case 5:\n          state = _context.sent;\n          _context.next = 8;\n          return hash.update(timestamp + '5cb82d4d6de8ff209bd7e6b3732cf258cadd59e38753d3f72d17692c327806bc8a360493');\n\n        case 8:\n          _filterByName = state.name ? \"&nameStartsWith=\".concat(state.name) : '';\n          offset = state.limit * state.offset;\n          _context.next = 12;\n          return call(fetch, \"https://gateway.marvel.com/v1/public/characters?ts=\".concat(timestamp, \"&\").concat(_filterByName, \"&orderBy=name&limit=\").concat(state.limit, \"&offset=\").concat(offset, \"&apikey=\").concat(PUBLIC_KEY, \"&hash=\").concat(hash.hex()));\n\n        case 12:\n          response = _context.sent;\n          _context.next = 15;\n          return response.json();\n\n        case 15:\n          responseBody = _context.sent;\n          _responseBody$data = responseBody.data, total = _responseBody$data.total, results = _responseBody$data.results;\n          _context.next = 19;\n          return put(Creators.fetchedHeroes(total, results));\n\n        case 19:\n          _context.next = 25;\n          break;\n\n        case 21:\n          _context.prev = 21;\n          _context.t0 = _context[\"catch\"](0);\n          _context.next = 25;\n          return console.log('erro ao consumir api ', _context.t0);\n\n        case 25:\n          _context.prev = 25;\n          _context.next = 28;\n          return put(TemplateCreators.hideLoader());\n\n        case 28:\n          return _context.finish(25);\n\n        case 29:\n        case \"end\":\n          return _context.stop();\n      }\n    }\n  }, _marked, null, [[0, 21, 25, 29]]);\n}\n\nfunction paginate(_ref) {\n  var offset;\n  return _regeneratorRuntime.wrap(function paginate$(_context2) {\n    while (1) {\n      switch (_context2.prev = _context2.next) {\n        case 0:\n          offset = _ref.offset;\n          _context2.next = 3;\n          return put(Creators.onPaginate(offset));\n\n        case 3:\n          _context2.next = 5;\n          return fetchHeroes();\n\n        case 5:\n        case \"end\":\n          return _context2.stop();\n      }\n    }\n  }, _marked2);\n}\n\nfunction filterByName(_ref2) {\n  var name;\n  return _regeneratorRuntime.wrap(function filterByName$(_context3) {\n    while (1) {\n      switch (_context3.prev = _context3.next) {\n        case 0:\n          name = _ref2.name;\n          _context3.next = 3;\n          return put(Creators.changeFilterName(name));\n\n        case 3:\n          _context3.next = 5;\n          return fetchHeroes();\n\n        case 5:\n        case \"end\":\n          return _context3.stop();\n      }\n    }\n  }, _marked3);\n}\n\nexport default [takeLatest(Types.FETCH_HEROES_ASYNC, fetchHeroes), takeLatest(Types.ON_PAGINATE_ASYNC, paginate), takeLatest(Types.ON_FILTER_ASYNC, filterByName)];","map":{"version":3,"sources":["C:\\Users\\MultiWEB\\Desktop\\toni-esterco\\src\\store\\heroes\\heroes-sagas.js"],"names":["fetchHeroes","paginate","filterByName","takeLatest","put","call","select","Types","Creators","TemplateCreators","md5","PUBLIC_KEY","timestamp","Number","Date","hash","create","getHeroesState","state","Heroes","showLoader","update","name","offset","limit","fetch","hex","response","json","responseBody","data","total","results","fetchedHeroes","console","log","hideLoader","onPaginate","changeFilterName","FETCH_HEROES_ASYNC","ON_PAGINATE_ASYNC","ON_FILTER_ASYNC"],"mappings":"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","sourcesContent":["import { takeLatest, put, call, select } from 'redux-saga/effects';\r\nimport { Types, Creators } from './heroes-duck';\r\nimport { Creators as TemplateCreators } from '../template-duck';\r\nimport md5 from \"js-md5\";\r\n\r\nconst PUBLIC_KEY = '8753d3f72d17692c327806bc8a360493';\r\n\r\nconst timestamp = Number(new Date());\r\nconst hash = md5.create();\r\n\r\nconst getHeroesState = (state) => state.Heroes;\r\n\r\nfunction* fetchHeroes() {\r\n  try {\r\n    yield put(TemplateCreators.showLoader());\r\n\r\n    const state = yield select(getHeroesState);\r\n\r\n    yield hash.update(timestamp + '5cb82d4d6de8ff209bd7e6b3732cf258cadd59e38753d3f72d17692c327806bc8a360493');\r\n\r\n    const filterByName = state.name ? `&nameStartsWith=${state.name}` : '';\r\n    let offset = state.limit * state.offset;\r\n\r\n    const response = yield call(fetch,\r\n      `https://gateway.marvel.com/v1/public/characters?ts=${timestamp}&${filterByName}&orderBy=name&limit=${state.limit}&offset=${offset}&apikey=${PUBLIC_KEY}&hash=${hash.hex()}`\r\n    );\r\n    const responseBody = yield response.json();\r\n\r\n    const { total, results } = responseBody.data;\r\n\r\n    yield put(Creators.fetchedHeroes(total, results));\r\n\r\n  } catch (e) {\r\n    yield console.log('erro ao consumir api ', e);\r\n  } finally {\r\n    yield put(TemplateCreators.hideLoader());\r\n  }\r\n}\r\n\r\nfunction* paginate({ offset }) {\r\n  yield put(Creators.onPaginate(offset));\r\n  yield fetchHeroes();\r\n}\r\n\r\nfunction* filterByName({ name }) {\r\n  yield put(Creators.changeFilterName(name));\r\n  yield fetchHeroes();\r\n}\r\n\r\nexport default [\r\n  takeLatest(Types.FETCH_HEROES_ASYNC, fetchHeroes),\r\n  takeLatest(Types.ON_PAGINATE_ASYNC, paginate),\r\n  takeLatest(Types.ON_FILTER_ASYNC, filterByName),];\r\n"]},"metadata":{},"sourceType":"module"}